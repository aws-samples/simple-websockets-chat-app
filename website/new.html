<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>New Chat</title>
    <style>
      body {
        margin: 0;
        font-family: Helvetica, Arial, sans-serif;
        -webkit-font-smoothing: antialiased;
        background-color: whitesmoke;
      }

      #root {
        max-width: 600px;
        margin: 0 auto;
        text-align: center;
        font-size: large;
      }

      #qr-container img {
        padding: 8px;
        border: 1px solid gainsboro;
        border-radius: 4px;
        background-color: white;
      }
    </style>
  </head>
  <body>
    <div id="root">
      <h1>New chat</h1>
      <div id="chat-link-container">
        <p>
          Get others to scan this code. Click it to join the chat.
        </p>
      </div>
      <div id="qr-container"></div>
    </div>
    <script type="text/javascript">
      function showQR(chatUrl) {
        const data = encodeURIComponent(chatUrl);
        const qrServerUrl = `https://api.qrserver.com/v1/create-qr-code/?data=${chatUrl}&size=500x500`;
        const qrLink = document.createElement("a");
        qrLink.href = chatUrl;
        const qrImage = document.createElement("img");
        qrImage.src = qrServerUrl;
        qrLink.appendChild(qrImage);
        document.getElementById("qr-container").appendChild(qrLink);
      }
      // https://stackoverflow.com/a/2117523/1128216
      const code = ([1e7] + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, (c) =>
        (
          c ^
          (crypto.getRandomValues(new Uint8Array(1))[0] & (15 >> (c / 4)))
        ).toString(16)
      );
      const chatUrl = "https://d2349yxwn419ex.cloudfront.net/" + code;

      showQR(chatUrl);
    </script>
  </body>
</html>
